name: Deploy to GitHub Pages

on:
  # 1. ç›‘å¬ä»£ç æ¨é€ (å…¼å®¹ main å’Œ master åˆ†æ”¯)
  push:
    branches:
      - main
      - master
  
  # 2. ğŸŸ¢ æ ¸å¿ƒä¿®å¤ï¼šæ·»åŠ æ‰‹åŠ¨è§¦å‘æŒ‰é’®
  workflow_dispatch:

# 3. å¿…é¡»èµ‹äºˆå†™æƒé™ï¼Œå¦åˆ™æ— æ³•æ¨é€åˆ° gh-pages åˆ†æ”¯
permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # --- ç¬¬ä¸€æ­¥ï¼šä¸‹è½½ä»£ç  ---
      - name: Checkout Code
        uses: actions/checkout@v4

      # --- ç¬¬äºŒæ­¥ï¼šæ›¿æ¢å˜é‡ (å¸¦é˜²ç©ºä¿æŠ¤) ---
      - name: Inject Environment Variables
        env:
          # å°è¯•è¯»å– Secretï¼Œå¦‚æœæ²¡æœ‰åˆ™è¯»å– Variable
          # å¦‚æœéƒ½æ²¡æœ‰ï¼Œå€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢çš„ run è„šæœ¬é‡Œå¤„ç†é»˜è®¤å€¼
          INPUT_EMAIL: ${{ secrets.MY_EMAIL || vars.MY_EMAIL }}
          INPUT_GITHUB: ${{ secrets.MY_GITHUB || vars.MY_GITHUB }}
        run: |
          echo "æ­£åœ¨æ£€æµ‹ç¯å¢ƒå˜é‡..."
          
          # Bash é€»è¾‘ï¼šå¦‚æœ INPUT_EMAIL ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼
          # :- æ„æ€æ˜¯ "å¦‚æœä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åé¢çš„å€¼"
          REAL_EMAIL="${INPUT_EMAIL:-void@dimension.null}"
          REAL_GITHUB="${INPUT_GITHUB:-https://github.com}"
          
          # æ‰“å°çŠ¶æ€ (Secretä¼šè¢«è‡ªåŠ¨æ‰“ç æ˜¾ç¤ºä¸º ***ï¼Œè¿™æ˜¯æ­£å¸¸çš„)
          echo "Injecting Email..."
          
          # ä½¿ç”¨ sed æ›¿æ¢ index.html ä¸­çš„å ä½ç¬¦
          # ä½¿ç”¨ | ä½œä¸ºåˆ†éš”ç¬¦ï¼Œé˜²æ­¢ URL ä¸­çš„ / æŠ¥é”™
          sed -i "s|{{MY_EMAIL}}|$REAL_EMAIL|g" index.html
          sed -i "s|{{MY_GITHUB}}|$REAL_GITHUB|g" index.html
          
          echo "æ›¿æ¢å®Œæˆï¼æ£€æŸ¥ index.html å‰10è¡Œç¡®è®¤æ›¿æ¢æƒ…å†µ:"
          head -n 10 index.html

      # --- ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²åˆ° gh-pages ---
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: .           # éƒ¨ç½²æ ¹ç›®å½•
          branch: gh-pages    # æ¨é€åˆ° gh-pages åˆ†æ”¯
          clean: true         # æ¯æ¬¡æ¸…ç†æ—§æ–‡ä»¶
